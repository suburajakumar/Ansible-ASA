---
- name: Get Cisco ASA version without collection modules
  hosts: cisco_asa
  gather_facts: false
  connection: network_cli 

  tasks:
    - name: 1. Execute 'show version' command
      ansible.builtin.cli_command:
        command: show version
      register: version_output

    - name: 2. Extract and Set ASA Version
      # Use set_fact to run the complex parsing logic separately
      ansible.builtin.set_fact:
        # The logic is simpler and safer here: find the line, split by space, grab the last item.
        asa_version_string: "{{ version_output.stdout[0] 
                                | regex_search('Software Version\\s*(\\S+)', '\\1') 
                                | first 
                                | default('N/A_VERSION') }}"

    - name: 3. Display the ASA version
      # Simple debug message, far less likely to fail validation
      ansible.builtin.debug:
        msg: "ASA Software Version on {{ inventory_hostname }}: {{ asa_version_string }}"