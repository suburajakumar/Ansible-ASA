---
- name: Get Cisco ASA version without collection modules
  hosts: cisco_asa
  gather_facts: false
  connection: network_cli 

  tasks:
    - name: 1. Execute 'show version' command
      ansible.builtin.cli_command:
        command: show version
      register: version_output

    - name: 2. Extract and Set ASA Version (re.split Fix)
      ansible.builtin.set_fact:
        asa_version_string: >
          {# Use re.split to split by the pattern "Software Version" and all subsequent whitespace #}
          {% set parts = version_output.stdout[0] | re_split('Software Version\\s*') %}
          {# The version number should be the first element of 'parts' after the split point #}
          {% if parts | length > 1 %}
          {# Split the resulting string by newline, take the first line, split by space, trim, and grab the first element #}
          {{ parts[1] | split('\n') | first | split(' ') | select('length') | list | first | trim }}
          {% else %}
          N/A_RE_FAILED
          {% endif %}

    - name: 3. Display the ASA version
      ansible.builtin.debug:
        msg: "ASA Software Version on {{ inventory_hostname }}: {{ asa_version_string }}"